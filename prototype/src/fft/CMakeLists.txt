set(DEPENDENCIES sll_utilities sll_timer sll_constants)

IF(FFTW_FOUND AND FFTW_ENABLED)
  ADD_LIBRARY(fftw_module STATIC fftw_module.F90)
  LIST(APPEND DEPENDENCIES fftw_module)
  TARGET_LINK_LIBRARIES(fftw_module ${FFTW_LIBRARIES})
  INCLUDE_DIRECTORIES(${FFTW_INCLUDE_DIRS})
ENDIF()

IF(${FFT_DEFAULT_LIBRARY} STREQUAL "FFTPACK")
  SET(FFT_SRC sll_fft_mod_through_fftpack.F90)
  SET(DEPENDENCIES ${DEPENDENCIES} dfftpack)
  ADD_DEFINITIONS(-D_DEFAULTFFTLIB=FFTPACK_MOD)
ELSEIF(${FFT_DEFAULT_LIBRARY} STREQUAL "FFTW")
  SET(FFT_SRC sll_fft_mod_through_legacy_fftw.F90)
  ADD_DEFINITIONS(-D_DEFAULTFFTLIB=FFTW_MOD)
ELSE()
  SET(FFT_SRC sll_fft_selalib_implementation.F90)
  ADD_DEFINITIONS(-D_DEFAULTFFTLIB=SLLFFT_MOD)
ENDIF()

ADD_LIBRARY(sll_fft STATIC ${FFT_SRC} sll_fft_utils.F90)

TARGET_LINK_LIBRARIES(sll_fft ${DEPENDENCIES})

ADD_EXECUTABLE(test_fft unit_test.F90)
TARGET_LINK_LIBRARIES(test_fft sll_fft)
