ADD_SUBDIRECTORY(fftpack)
ADD_SUBDIRECTORY(fftpack5)
ADD_SUBDIRECTORY(pppack)
ADD_SUBDIRECTORY(nufft)
ADD_SUBDIRECTORY(burkardt)

IF(BUILD_MUDPACK)
  ADD_SUBDIRECTORY(mudpack)
ENDIF(BUILD_MUDPACK)

SET(BUILD_PLAF  OFF CACHE BOOL "PLAF  Parallel Linear Algebra Framework")
SET(BUILD_DISCO OFF CACHE BOOL "DISCO Abstract discretization context library in Fortran 2008")
SET(BUILD_SPIGA OFF CACHE BOOL "SPIGA Structure Preserving IsoGeometric Analysis")

IF(BUILD_SPIGA)
  SET(BUILD_DISCO ON)
ENDIF(BUILD_SPIGA)
IF(BUILD_DISCO)
  SET(BUILD_PLAF  ON)
ENDIF(BUILD_DISCO)

IF(BUILD_PLAF)
   INCLUDE(ExternalProject)
   EXTERNALPROJECT_ADD(
     plaf
     PREFIX plaf
     GIT_TAG devel
     GIT_REPOSITORY git@gitlab.mpcdf.mpg.de:clapp/plaf.git
     CMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${CMAKE_BINARY_DIR} -DBUILD_TESTING=OFF -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE})
ENDIF()

IF(BUILD_DISCO)
   INCLUDE(ExternalProject)
   EXTERNALPROJECT_ADD(
     disco
     PREFIX disco
     GIT_TAG devel
     GIT_REPOSITORY git@gitlab.mpcdf.mpg.de:clapp/disco.git
     CMAKE_ARGS -DPLAF_DIR=${CMAKE_BINARY_DIR} -DCMAKE_INSTALL_PREFIX=${CMAKE_BINARY_DIR} -DBUILD_TESTING=OFF -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE})

   ADD_DEPENDENCIES(disco plaf)

ENDIF()

IF(BUILD_SPIGA)
   INCLUDE(ExternalProject)
   EXTERNALPROJECT_ADD(
     spiga
     PREFIX spiga
     GIT_TAG devel
     GIT_REPOSITORY git@gitlab.mpcdf.mpg.de:clapp/spiga.git
     CMAKE_ARGS -DPLAF_DIR=${CMAKE_BINARY_DIR} -DDISCO_DIR=${CMAKE_BINARY_DIR}  -DCMAKE_INSTALL_PREFIX=${CMAKE_BINARY_DIR} -DBUILD_EXAMPLES=OFF -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE})

   ADD_DEPENDENCIES(spiga disco)
   ADD_SUBDIRECTORY(spiga)

ENDIF()
