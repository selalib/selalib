ADD_SUBDIRECTORY(sparse_matrix_manager)
ADD_SUBDIRECTORY(fft)

IF(BUILD_JOREK)

  SET(GIT_LOGIN $ENV{USER} CACHE STRING "INRIA GForge login")
  INCLUDE(ExternalProject)

  SET(JOREK_GIT_REPOSITORY git+ssh://${GIT_LOGIN}@scm.gforge.inria.fr/gitroot/jorek/jorek.git)

  IF(APPLE)
    SET(JOREK_CMAKE_ARGS -DBUILD_TESTING=OFF -DJOREK_DEBUG_TRACE=OFF -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE} -DJOREK_SAVE_MATRIX=OFF)
  ELSE(APPLE)
    SET(JOREK_CMAKE_ARGS -DBUILD_TESTING=OFF -DJOREK_DEBUG_TRACE=OFF -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE} -DJOREK_SAVE_MATRIX=OFF -DPETSC_DIR=${PETSC_DIR} -DPETSC_ARCH=${PETSC_ARCH})
  ENDIF(APPLE)

  IF(BUILD_PACKAGE)

    EXTERNALPROJECT_ADD(
      jorek
      GIT_REPOSITORY ${JOREK_GIT_REPOSITORY}
      GIT_TAG ${JOREK_GIT_BRANCH}
      CMAKE_ARGS ${JOREK_CMAKE_ARGS} -DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}
      )

  ELSE()

    EXTERNALPROJECT_ADD(
      jorek
      GIT_REPOSITORY ${JOREK_GIT_REPOSITORY}
      GIT_TAG ${JOREK_GIT_BRANCH}
      CMAKE_ARGS ${JOREK_CMAKE_ARGS}
      INSTALL_COMMAND "")

  ENDIF()
  
  FIND_PACKAGE(PETSc)
  ADD_SUBDIRECTORY(jorek)

ENDIF()
