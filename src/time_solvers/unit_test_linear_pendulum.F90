!> @ingroup operator_splitting
!> @brief Unit test for operator splitting. Order check for linear pendulum 
!> 

program test_operator_splitting_linear_pendulum
#include "sll_working_precision.h"
#include "sll_memory.h"
  
  use sll_linear_pendulum_operators
  implicit none
 
  ! variables
  logical :: test_passed
  logical :: all_tests_passed = .true.
  sll_real64 :: steps_fine
  sll_int32  :: expected_order
  
  ! test SLL_LIE_TV
  steps_fine = 200
  expected_order = 1
  test_passed = .true.
  call check_order(SLL_LIE_TV,steps_fine, expected_order, test_passed)
  if (.not.(test_passed)) then
     print*, 'Problem with order of SLL_LIE_TV'
     all_tests_passed = .false.
  end if

  ! test SLL_LIE_VT
  steps_fine = 200
  expected_order = 1
  test_passed = .true.
  call check_order(SLL_LIE_VT,steps_fine, expected_order, test_passed)
   if (.not.(test_passed)) then
     print*, 'Problem with order of SLL_LIE_VT'
     all_tests_passed = .false.
  end if

  ! test SLL_STRANG_TVT
  steps_fine = 100
  expected_order = 2
  test_passed = .true.
  call check_order(SLL_STRANG_TVT,steps_fine, expected_order, test_passed)
  if (.not.(test_passed)) then
     print*, 'Problem with order of SLL_STRANG_TVT'
     all_tests_passed = .false.
  end if

  ! test SLL_STRANG_VTV
  steps_fine = 100
  expected_order = 2
  test_passed = .true.
  call check_order(SLL_STRANG_VTV,steps_fine, expected_order, test_passed)
  if (.not.(test_passed)) then
     print*, 'Problem with order of SLL_STRANG_VTV'
     all_tests_passed = .false.
  end if

  ! test SLL_TRIPLE_JUMP_TVT
  steps_fine = 64
  expected_order = 4
  test_passed = .true.
  call check_order(SLL_TRIPLE_JUMP_TVT,steps_fine, expected_order, test_passed)
  if (.not.(test_passed)) then
     print*, 'Problem with order of SLL_TRIPLE_JUMP_TVT'
     all_tests_passed = .false.
  end if
  
  ! test SLL_TRIPLE_JUMP_VTV
  steps_fine = 64
  expected_order = 4
  test_passed = .true.
  call check_order(SLL_TRIPLE_JUMP_VTV,steps_fine, expected_order, test_passed)
  if (.not.(test_passed)) then
     print*, 'Problem with order of SLL_TRIPLE_JUMP_VTV'
     all_tests_passed = .false.
  end if
  
  ! test SLL_ORDER6_TVT 
  steps_fine = 20
  expected_order = 6
  test_passed = .true.
  call check_order(SLL_ORDER6_TVT,steps_fine, expected_order, test_passed)
  if (.not.(test_passed)) then
     print*, 'Problem with order of SLL_ORDER6_TVT'
     all_tests_passed = .false.
  end if

  ! test SLL_ORDER6_VTV 
  steps_fine = 20
  expected_order = 6
  test_passed = .true.
  call check_order(SLL_ORDER6_VTV,steps_fine, expected_order, test_passed)
  if (.not.(test_passed)) then
     print*, 'Problem with order of SLL_ORDER6_VTV'
     all_tests_passed = .false.
  end if

  if (.not.(test_passed)) call exit(1)

end program test_operator_splitting_linear_pendulum

