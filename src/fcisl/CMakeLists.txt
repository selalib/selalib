IF( NOT STDF95)
IF(HDF5_ENABLED)
#hdf5 is parallel and inside aligned_translation_2d.F90
#hdf5 is used
#so the compiler should be parallel
#should be changed
 
  IF(MPI_ENABLED)
    SET(CMAKE_Fortran_COMPILER ${MPI_Fortran_COMPILER})
  ENDIF()

  ADD_LIBRARY( sll_fcisl STATIC fcisl.F90 )
  TARGET_LINK_LIBRARIES( sll_fcisl sll_advection sll_utilities )

  ADD_LIBRARY( sll_derivative STATIC sll_derivative_2d_oblic.F90 )
  TARGET_LINK_LIBRARIES( sll_derivative 
    sll_advection
    sll_fcisl
    sll_utilities )

  ADD_LIBRARY( sll_fcisl_toroidal STATIC fcisl_toroidal.F90 )
  TARGET_LINK_LIBRARIES( sll_fcisl_toroidal sll_advection sll_utilities sll_file_io )


  # Tests
  IF(BUILD_TESTING)
  
    ADD_EXECUTABLE( test_fcisl unit_test.F90 )
    TARGET_LINK_LIBRARIES( test_fcisl 
      sll_fcisl
      sll_meshes 
      sll_advection
      sll_constants )

    ADD_EXECUTABLE( test_derivative_2d_oblic unit_test_derivative_2d_oblic.F90 )
    TARGET_LINK_LIBRARIES( test_derivative_2d_oblic 
      sll_derivative
      sll_fcisl
      sll_meshes 
      sll_advection
      sll_constants)

    ADD_EXECUTABLE( test_aligned_derivative_2d aligned_derivative_2d.F90 )
    TARGET_LINK_LIBRARIES( test_aligned_derivative_2d 
      sll_derivative
      sll_fcisl
      sll_meshes 
      sll_advection
      sll_constants )

    ADD_EXECUTABLE( test_fcisl_toroidal test_fcisl_toroidal.F90 )
    TARGET_LINK_LIBRARIES( test_fcisl_toroidal 
      sll_fcisl_toroidal
      sll_meshes 
      sll_advection
      sll_constants )


  ENDIF(BUILD_TESTING)

ENDIF(HDF5_ENABLED)
ENDIF(NOT STDF95)
