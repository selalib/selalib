set ( TEST_NAME pic_vm_1d2v_cart )
set ( SIM_NAME pic_vm_1d2v_cart )
set ( EXECUTABLE "sim_${TEST_NAME}")
set( INSTALL_DIR "${INSTALL_DIR}/${TEST_NAME}" )

file( GLOB INPUT_FILES "*.nml"         )

ADD_EXECUTABLE( ${EXECUTABLE} sll_m_sim_${SIM_NAME}.F90
                              sim_${TEST_NAME}.F90 )
TARGET_LINK_LIBRARIES( ${EXECUTABLE}
  sll_sim_parallel
  sll_working_precision
  sll_pic_interface
  sll_particle_initializers
  sll_particle_types
  sll_kernel_smoothers
  sll_particle_pushers
  sll_maxwell_solvers)

INSTALL( TARGETS ${EXECUTABLE}                     DESTINATION ${INSTALL_DIR} )
INSTALL( FILES  ${INPUT_FILES} README ${POST_PROC} DESTINATION ${INSTALL_DIR} )

# For the moment the simulation is not prepared to be a ctest
## Ctest
#IF(BUILD_TESTING)
#  FILE( COPY ${INPUT_FILES} DESTINATION ${CMAKE_CURRENT_BINARY_DIR} )
#  SET( ARGS ${CMAKE_CURRENT_BINARY_DIR}/params_pic_vm_1d2v.nml )
#  ADD_MPI_TEST( ${TEST_NAME} ${EXECUTABLE} ${PROCS} ${ARGS} )
#  SET_TESTS_PROPERTIES( ${TEST_NAME} PROPERTIES PASS_REGULAR_EXPRESSION "PASSED"
#    TIMEOUT 200 )
#ENDIF(BUILD_TESTING)
