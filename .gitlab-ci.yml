image: pnavaro/selalib

ubuntu-openmpi:
  stage: build
  script: 
    - mkdir -p public build
    - cd build && cmake .. -DHDF5_PARALLEL_ENABLED=ON -DCMAKE_BUILD_TYPE=Release && make
  only:
    - master
  tags:
    - large
  artifacts:
    paths:
      - build
    
ctest:
  stage: test
  script:
    - cd build && make test
  allow_failure: true
  artifacts:
      paths:
        - public
  only:
    - master
  artifacts:
    paths:
      - build
  tags:
    - large

pages:
  stage: deploy
  script:
    - cd build && make doc-dev
    - mv doc/html ../public
  only:
    - master
  artifacts:
    paths:
      - public
  tags:
    - large
