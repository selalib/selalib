image: pnavaro/selalib

ubuntu-mpich:
  stage: build
  allow_failure: true
  script: 
    - mkdir -p build
    - cd build && cmake -DCMAKE_BUILD_TYPE=Release -DHDF5_PARALLEL_ENABLED=ON .. && make -j
  only:
    - develop
  tags:
    - ubuntu
    - mpich
    
fedora-openmpi:
  stage: build
  allow_failure: true
  script: 
    - mkdir -p build
    - source /etc/profile.d/modules.sh && module load mpi/openmpi-x86_64
    - cd build && cmake -DCMAKE_BUILD_TYPE=Debug -DHDF5_PARALLEL_ENABLED=ON .. && make -j
  only:
    - develop
  tags:
    - fedora
    - openmpi

ubuntu-build:
  stage: build
  script:
    - mkdir -p build
    - cd build && cmake .. -DHDF5_PARALLEL_ENABLED=ON && make -j
  artifacts:
    paths:
      - build

ubuntu-test:
  stage: test
  allow_failure: true
  script:
    - cd build && make test
  artifacts:
    paths:
      - build

pages:
  stage: deploy
  script:
    - cd build && make doc-dev
    - cd  ../doc && make
    - mv build/html ../public
    - mv ../build/doc/html ../public/doc
  artifacts:
    paths:
      - public
  only:
    - develop
  tags:
    - docker



#intel-impi:
#  stage: build
#  script:
#    - "scripts/intel16-build.sh"
#  only:
#    - develop
#  tags:
#    - intel
    
#ubuntu-openmpi:
#  tags:
#    - ubuntu
#    - openmpi
#  stage: build
#  script: 
#    - "scripts/selalib-ci.sh"
#  only:
#    - develop

#  
#
#

#    
#mavericks-openmpi:
#  stage: build
#  script: 
#    - "scripts/selalib-ci.sh"
#  only:
#    - develop
#  tags:
#    - osx
#    - openmpi
#    
#mavericks-mpich:
#  stage: build
#  script: 
#    - "scripts/selalib-ci.sh"
#  only:
#    - develop
#  tags:
#    - osx
#    - mpich  
  
